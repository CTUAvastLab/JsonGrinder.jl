<!DOCTYPE html><HTML lang="en"><head><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>AutoML · JsonGrinder.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script data-main="../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" data-theme-name="documenter-dark" data-theme-primary-dark="" href="../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../assets/custom.css" rel="stylesheet" type="text/css"/><script data-is-old-version="">document.addEventListener("DOMContentLoaded", function () {
    if (document.body.querySelector('meta[name="robots"]') === null) {
        const meta = document.createElement('meta');
        meta.name = 'robots';
        meta.content = 'noindex';
        document.getElementsByTagName('head')[0].appendChild(meta);
    };
    const div = document.createElement('div');
    div.setAttribute('style', 'position: fixed; width: 100%; top: 0; left: 0; box-shadow: 0 0 10px rgba(0,0,0,0.3); z-index: 999; background-color: #ffaf9c; color: rgba(0, 0, 0, 0.7); border-bottom: 1px solid #d54625; padding: 10px 35px; text-align: center; font-size: 15px;');
    const closer = document.createElement('div');
    closer.setAttribute('style', 'position: absolute; top: calc(50% - 8px); right: 18px; cursor: pointer; width: 12px;');
    // Icon by font-awesome (license: https://fontawesome.com/license, link: https://fontawesome.com/icons/times?style=solid)
    closer.innerHTML = '<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg>';
    closer.addEventListener('click', function () {
        document.body.removeChild(div);
    });
    let href = '/stable';
    if (window.documenterBaseURL) {
        href = window.documenterBaseURL + '/../stable';
    }
    div.innerHTML = 'This is an old version of the documentation. <br> <a href="' + href + '" style="color: rgb(46, 99, 184)">Go to the newest version</a>.';
    div.appendChild(closer);
    document.body.appendChild(div);
});
</script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img alt="JsonGrinder.jl logo" class="docs-light-only" src="../assets/logo.svg"/><img alt="JsonGrinder.jl logo" class="docs-dark-only" src="../assets/logo-dark.svg"/></a><form action="../search/" class="docs-search"><input class="docs-search-query" id="documenter-search-query" name="q" placeholder="Search docs" type="text"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../schema/">Schema</a></li><li><a class="tocitem" href="../extractors/">Creating extractors</a></li><li><a class="tocitem" href="../exfunctions/">Extractor functions</a></li><li class="is-active"><a class="tocitem" href="">AutoML</a></li><li><a class="tocitem" href="../api/">API Documentation</a></li><li><a class="tocitem" href="../developers/">Developers</a></li><li><a class="tocitem" href="../citation/">Citation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="">AutoML</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">AutoML</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/pevnak/JsonGrinder.jl/blob/master/docs/src/automl.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a></div></header><article class="content" id="documenter-page"><h1 id="Integrating-with-Hyperopt.jl"><a class="docs-heading-anchor" href="#Integrating-with-Hyperopt.jl">Integrating with Hyperopt.jl</a><a id="Integrating-with-Hyperopt.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Integrating-with-Hyperopt.jl" title="Permalink"></a></h1><p><code>JsonGrinder.jl</code> and <code>Mill.jl</code> went long way to simplify creation of classifiers from data stored in JSONs, but they purposefully skipped the optimization of the architecture, as we authors believe this should be handled by other special-purpose libraries. Below, we show how to use <code>Hyperopt.jl</code> to do this optimization for us. Even though it is far from optimal, we can run it and forget it. The example will be based on DeviceID example, but it is quite oblivious. We start by explaining the core concepts and at the end we will include it into a full-fleged example. </p><p>First, we create a simple function, which creates a feed-forward neural networks with input dimenions <code>idim</code>, <code>nlayers</code> number of hidden layers, <code>nneurons</code> number of neurons in hidden and output layer, <code>fun</code>  nonlinearity, and <code>bnfun</code>  nonlinearity ( <code>nothing</code> meanins disabled)</p><pre><code class="language-julia">function ffnn(idim, nneurons, nlayers, fun, bnfun)
  c = []
  for i in 1:nlayers
    idim = i == 1 ? idim : nneurons
    push!(c, Dense(idim, nneurons, fun))
    if bnfun != nothing
      push!(c, BatchNorm(nneurons, bnfun))
    end
  end
  Chain(c...)
end</code></pre><p>In our example, we will use <em>Hyperband</em> algorithm for its simplicity (and hopefully good results). It requires us to define two functions: first initializes the model, the second trains it for predefined number of iterations while supporting warm-start.</p><pre><code class="language-julia">function evaluatemodel(specimen, nneurons, nlayers, fun, bnfun, η)
  model = reflectinmodel(specimen, 
    d -&gt; ffnn(d, nneurons, nlayers, fun, bnfun),
    SegmentedMeanMax, 
    fsm = Dict("" =&gt; d -&gt; Chain(ffnn(d, nneurons, nlayers, fun, bnfun)..., Dense(nneurons, 2)))
    )
  opt = ADAM(η)
  evaluatemodel(2000, model, opt)
end

function evaluatemodel(iterations, model, opt)
  ps = Flux.params(model);
  train!((x...) -&gt; loss(model, x...), ps, minibatch, opt, iterations)
  e =  error(validation_set)
  (e, (model, opt, cby))
end</code></pre><p>The call of Hyperband from <code>hyperband.jl</code>, where we prescribed the possible values for each value (for futher details see docs of <code>Hyperopt.jl</code>). (<code>Hyperband</code> does not use the parameter <code>i</code>, therefore I set it to zero. Parameter <code>R</code> determines number of resources, which corresponds to the number of tried confgiurations created by <code>RandomSamples</code> and <code>η</code> determines fraction of distarded solutions (which means that 18 solutions will be discarded in the second step). The invokation of hyperband looks like</p><pre><code class="language-julia">ho = @hyperopt for i=0,
            sampler = Hyperband(R=27, η=3, inner=RandomSampler()),
            nneurons = [8,16,32,64,128],
            nlayers = [1,2,3],
            fun = [relu, tanh],
            # bnfun = [nothing, identity, relu, tanh],
            bnfun = [nothing],
            η = [1e-2,1e-3,1e-4]
  if state === nothing
    @show (nneurons, nlayers, fun, bnfun, η)
    res = evaluatemodel(specimen, nneurons, nlayers, fun, bnfun, η)
  else
     
      res = evaluatemodel(3000, state...)
  end
  res
end

model, opt = ho.minimizer</code></pre><p>and we can fine-tune the model</p><pre><code class="language-julia">final = evaluatemodel(20000, model, opt)
trn = = accuracy(model, trnfiles)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../exfunctions/">« Extractor functions</a><a class="docs-footer-nextpage" href="../api/">API Documentation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 2 February 2021 14:04">Tuesday 2 February 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>